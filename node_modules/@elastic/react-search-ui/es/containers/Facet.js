import _objectWithoutProperties from "@babel/runtime/helpers/objectWithoutProperties";
import _classCallCheck from "@babel/runtime/helpers/classCallCheck";
import _createClass from "@babel/runtime/helpers/createClass";
import _assertThisInitialized from "@babel/runtime/helpers/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/inherits";
import _possibleConstructorReturn from "@babel/runtime/helpers/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime/helpers/getPrototypeOf";
import _defineProperty from "@babel/runtime/helpers/defineProperty";

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }

function _isNativeReflectConstruct() { if (typeof Reflect === "undefined" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === "function") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }

import PropTypes from "prop-types";
import { Component } from "react";
import { MultiCheckboxFacet } from "@elastic/react-search-ui-views";
import { helpers } from "@elastic/search-ui";
import { Facet, Filter, FilterType } from "../types";
import { accentFold } from "../helpers";
import { withSearch } from "..";
var markSelectedFacetValuesFromFilters = helpers.markSelectedFacetValuesFromFilters;
export var FacetContainer = /*#__PURE__*/function (_Component) {
  _inherits(FacetContainer, _Component);

  var _super = _createSuper(FacetContainer);

  function FacetContainer(_ref) {
    var _this;

    var _ref$show = _ref.show,
        show = _ref$show === void 0 ? 5 : _ref$show;

    _classCallCheck(this, FacetContainer);

    _this = _super.call(this);

    _defineProperty(_assertThisInitialized(_this), "handleClickMore", function (totalOptions) {
      _this.setState(function (_ref2) {
        var more = _ref2.more;
        var visibleOptionsCount = more + 10;
        var showingAll = visibleOptionsCount >= totalOptions;
        if (showingAll) visibleOptionsCount = totalOptions;

        _this.props.a11yNotify("moreFilters", {
          visibleOptionsCount: visibleOptionsCount,
          showingAll: showingAll
        });

        return {
          more: visibleOptionsCount
        };
      });
    });

    _defineProperty(_assertThisInitialized(_this), "handleFacetSearch", function (searchTerm) {
      _this.setState({
        searchTerm: searchTerm
      });
    });

    _this.state = {
      more: show,
      searchTerm: ""
    };
    return _this;
  }

  _createClass(FacetContainer, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$state = this.state,
          more = _this$state.more,
          searchTerm = _this$state.searchTerm;

      var _this$props = this.props,
          addFilter = _this$props.addFilter,
          className = _this$props.className,
          facets = _this$props.facets,
          field = _this$props.field,
          filterType = _this$props.filterType,
          filters = _this$props.filters,
          label = _this$props.label,
          removeFilter = _this$props.removeFilter,
          setFilter = _this$props.setFilter,
          view = _this$props.view,
          isFilterable = _this$props.isFilterable,
          a11yNotify = _this$props.a11yNotify,
          rest = _objectWithoutProperties(_this$props, ["addFilter", "className", "facets", "field", "filterType", "filters", "label", "removeFilter", "setFilter", "view", "isFilterable", "a11yNotify"]);

      var facetsForField = facets[field];
      if (!facetsForField) return null; // By using `[0]`, we are currently assuming only 1 facet per field. This will likely be enforced
      // in future version, so instead of an array, there will only be one facet allowed per field.

      var facet = facetsForField[0];
      var facetValues = markSelectedFacetValuesFromFilters(facet, filters, field, filterType).data;
      var selectedValues = facetValues.filter(function (fv) {
        return fv.selected;
      }).map(function (fv) {
        return fv.value;
      });
      if (!facetValues.length && !selectedValues.length) return null;

      if (searchTerm.trim()) {
        facetValues = facetValues.filter(function (option) {
          return accentFold(option.value).toLowerCase().includes(accentFold(searchTerm).toLowerCase());
        });
      }

      var View = view || MultiCheckboxFacet;
      return View(_objectSpread({
        className: className,
        label: label,
        onMoreClick: this.handleClickMore.bind(this, facetValues.length),
        onRemove: function onRemove(value) {
          removeFilter(field, value, filterType);
        },
        onChange: function onChange(value) {
          setFilter(field, value, filterType);
        },
        onSelect: function onSelect(value) {
          addFilter(field, value, filterType);
        },
        options: facetValues.slice(0, more),
        showMore: facetValues.length > more,
        values: selectedValues,
        showSearch: isFilterable,
        onSearch: function onSearch(value) {
          _this2.handleFacetSearch(value);
        },
        searchPlaceholder: "Filter ".concat(field)
      }, rest));
    }
  }]);

  return FacetContainer;
}(Component);

_defineProperty(FacetContainer, "propTypes", {
  // Props
  className: PropTypes.string,
  field: PropTypes.string.isRequired,
  label: PropTypes.string.isRequired,
  filterType: FilterType,
  show: PropTypes.number,
  view: PropTypes.func,
  isFilterable: PropTypes.bool,
  // State
  filters: PropTypes.arrayOf(Filter).isRequired,
  facets: PropTypes.objectOf(PropTypes.arrayOf(Facet)).isRequired,
  // Actions
  addFilter: PropTypes.func.isRequired,
  removeFilter: PropTypes.func.isRequired,
  setFilter: PropTypes.func.isRequired,
  a11yNotify: PropTypes.func.isRequired
});

_defineProperty(FacetContainer, "defaultProps", {
  filterType: "all",
  isFilterable: false
});

export default withSearch(function (_ref3) {
  var filters = _ref3.filters,
      facets = _ref3.facets,
      addFilter = _ref3.addFilter,
      removeFilter = _ref3.removeFilter,
      setFilter = _ref3.setFilter,
      a11yNotify = _ref3.a11yNotify;
  return {
    filters: filters,
    facets: facets,
    addFilter: addFilter,
    removeFilter: removeFilter,
    setFilter: setFilter,
    a11yNotify: a11yNotify
  };
})(FacetContainer);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb250YWluZXJzL0ZhY2V0LmpzIl0sIm5hbWVzIjpbIlByb3BUeXBlcyIsIkNvbXBvbmVudCIsIk11bHRpQ2hlY2tib3hGYWNldCIsImhlbHBlcnMiLCJGYWNldCIsIkZpbHRlciIsIkZpbHRlclR5cGUiLCJhY2NlbnRGb2xkIiwid2l0aFNlYXJjaCIsIm1hcmtTZWxlY3RlZEZhY2V0VmFsdWVzRnJvbUZpbHRlcnMiLCJGYWNldENvbnRhaW5lciIsInNob3ciLCJ0b3RhbE9wdGlvbnMiLCJzZXRTdGF0ZSIsIm1vcmUiLCJ2aXNpYmxlT3B0aW9uc0NvdW50Iiwic2hvd2luZ0FsbCIsInByb3BzIiwiYTExeU5vdGlmeSIsInNlYXJjaFRlcm0iLCJzdGF0ZSIsImFkZEZpbHRlciIsImNsYXNzTmFtZSIsImZhY2V0cyIsImZpZWxkIiwiZmlsdGVyVHlwZSIsImZpbHRlcnMiLCJsYWJlbCIsInJlbW92ZUZpbHRlciIsInNldEZpbHRlciIsInZpZXciLCJpc0ZpbHRlcmFibGUiLCJyZXN0IiwiZmFjZXRzRm9yRmllbGQiLCJmYWNldCIsImZhY2V0VmFsdWVzIiwiZGF0YSIsInNlbGVjdGVkVmFsdWVzIiwiZmlsdGVyIiwiZnYiLCJzZWxlY3RlZCIsIm1hcCIsInZhbHVlIiwibGVuZ3RoIiwidHJpbSIsIm9wdGlvbiIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJWaWV3Iiwib25Nb3JlQ2xpY2siLCJoYW5kbGVDbGlja01vcmUiLCJiaW5kIiwib25SZW1vdmUiLCJvbkNoYW5nZSIsIm9uU2VsZWN0Iiwib3B0aW9ucyIsInNsaWNlIiwic2hvd01vcmUiLCJ2YWx1ZXMiLCJzaG93U2VhcmNoIiwib25TZWFyY2giLCJoYW5kbGVGYWNldFNlYXJjaCIsInNlYXJjaFBsYWNlaG9sZGVyIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsIm51bWJlciIsImZ1bmMiLCJib29sIiwiYXJyYXlPZiIsIm9iamVjdE9mIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7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UyxDQUFDa0UsSUFBVixDQUFlRixVQWJUO0FBY2pCcEMsRUFBQUEsWUFBWSxFQUFFNUIsU0FBUyxDQUFDa0UsSUFBVixDQUFlRixVQWRaO0FBZWpCbkMsRUFBQUEsU0FBUyxFQUFFN0IsU0FBUyxDQUFDa0UsSUFBVixDQUFlRixVQWZUO0FBZ0JqQjlDLEVBQUFBLFVBQVUsRUFBRWxCLFNBQVMsQ0FBQ2tFLElBQVYsQ0FBZUY7QUFoQlYsQzs7Z0JBRFJ0RCxjLGtCQW9CVztBQUNwQmUsRUFBQUEsVUFBVSxFQUFFLEtBRFE7QUFFcEJNLEVBQUFBLFlBQVksRUFBRTtBQUZNLEM7O0FBd0d4QixlQUFldkIsVUFBVSxDQUN2QjtBQUFBLE1BQUdrQixPQUFILFNBQUdBLE9BQUg7QUFBQSxNQUFZSCxNQUFaLFNBQVlBLE1BQVo7QUFBQSxNQUFvQkYsU0FBcEIsU0FBb0JBLFNBQXBCO0FBQUEsTUFBK0JPLFlBQS9CLFNBQStCQSxZQUEvQjtBQUFBLE1BQTZDQyxTQUE3QyxTQUE2Q0EsU0FBN0M7QUFBQSxNQUF3RFgsVUFBeEQsU0FBd0RBLFVBQXhEO0FBQUEsU0FBMEU7QUFDeEVRLElBQUFBLE9BQU8sRUFBUEEsT0FEd0U7QUFFeEVILElBQUFBLE1BQU0sRUFBTkEsTUFGd0U7QUFHeEVGLElBQUFBLFNBQVMsRUFBVEEsU0FId0U7QUFJeEVPLElBQUFBLFlBQVksRUFBWkEsWUFKd0U7QUFLeEVDLElBQUFBLFNBQVMsRUFBVEEsU0FMd0U7QUFNeEVYLElBQUFBLFVBQVUsRUFBVkE7QUFOd0UsR0FBMUU7QUFBQSxDQUR1QixDQUFWLENBU2JSLGNBVGEsQ0FBZiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9wVHlwZXMgZnJvbSBcInByb3AtdHlwZXNcIjtcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHsgTXVsdGlDaGVja2JveEZhY2V0IH0gZnJvbSBcIkBlbGFzdGljL3JlYWN0LXNlYXJjaC11aS12aWV3c1wiO1xuaW1wb3J0IHsgaGVscGVycyB9IGZyb20gXCJAZWxhc3RpYy9zZWFyY2gtdWlcIjtcblxuaW1wb3J0IHsgRmFjZXQsIEZpbHRlciwgRmlsdGVyVHlwZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuaW1wb3J0IHsgYWNjZW50Rm9sZCB9IGZyb20gXCIuLi9oZWxwZXJzXCI7XG5pbXBvcnQgeyB3aXRoU2VhcmNoIH0gZnJvbSBcIi4uXCI7XG5cbmNvbnN0IHsgbWFya1NlbGVjdGVkRmFjZXRWYWx1ZXNGcm9tRmlsdGVycyB9ID0gaGVscGVycztcblxuZXhwb3J0IGNsYXNzIEZhY2V0Q29udGFpbmVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvLyBQcm9wc1xuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgICBmaWVsZDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIGxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gICAgZmlsdGVyVHlwZTogRmlsdGVyVHlwZSxcbiAgICBzaG93OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIHZpZXc6IFByb3BUeXBlcy5mdW5jLFxuICAgIGlzRmlsdGVyYWJsZTogUHJvcFR5cGVzLmJvb2wsXG4gICAgLy8gU3RhdGVcbiAgICBmaWx0ZXJzOiBQcm9wVHlwZXMuYXJyYXlPZihGaWx0ZXIpLmlzUmVxdWlyZWQsXG4gICAgZmFjZXRzOiBQcm9wVHlwZXMub2JqZWN0T2YoUHJvcFR5cGVzLmFycmF5T2YoRmFjZXQpKS5pc1JlcXVpcmVkLFxuICAgIC8vIEFjdGlvbnNcbiAgICBhZGRGaWx0ZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgcmVtb3ZlRmlsdGVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIHNldEZpbHRlcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBhMTF5Tm90aWZ5OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkXG4gIH07XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBmaWx0ZXJUeXBlOiBcImFsbFwiLFxuICAgIGlzRmlsdGVyYWJsZTogZmFsc2VcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcih7IHNob3cgPSA1IH0pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBtb3JlOiBzaG93LFxuICAgICAgc2VhcmNoVGVybTogXCJcIlxuICAgIH07XG4gIH1cblxuICBoYW5kbGVDbGlja01vcmUgPSB0b3RhbE9wdGlvbnMgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoKHsgbW9yZSB9KSA9PiB7XG4gICAgICBsZXQgdmlzaWJsZU9wdGlvbnNDb3VudCA9IG1vcmUgKyAxMDtcbiAgICAgIGNvbnN0IHNob3dpbmdBbGwgPSB2aXNpYmxlT3B0aW9uc0NvdW50ID49IHRvdGFsT3B0aW9ucztcbiAgICAgIGlmIChzaG93aW5nQWxsKSB2aXNpYmxlT3B0aW9uc0NvdW50ID0gdG90YWxPcHRpb25zO1xuXG4gICAgICB0aGlzLnByb3BzLmExMXlOb3RpZnkoXCJtb3JlRmlsdGVyc1wiLCB7IHZpc2libGVPcHRpb25zQ291bnQsIHNob3dpbmdBbGwgfSk7XG5cbiAgICAgIHJldHVybiB7IG1vcmU6IHZpc2libGVPcHRpb25zQ291bnQgfTtcbiAgICB9KTtcbiAgfTtcblxuICBoYW5kbGVGYWNldFNlYXJjaCA9IHNlYXJjaFRlcm0gPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2hUZXJtIH0pO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IG1vcmUsIHNlYXJjaFRlcm0gfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3Qge1xuICAgICAgYWRkRmlsdGVyLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgZmFjZXRzLFxuICAgICAgZmllbGQsXG4gICAgICBmaWx0ZXJUeXBlLFxuICAgICAgZmlsdGVycyxcbiAgICAgIGxhYmVsLFxuICAgICAgcmVtb3ZlRmlsdGVyLFxuICAgICAgc2V0RmlsdGVyLFxuICAgICAgdmlldyxcbiAgICAgIGlzRmlsdGVyYWJsZSxcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICAgICAgYTExeU5vdGlmeSxcbiAgICAgIC4uLnJlc3RcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBmYWNldHNGb3JGaWVsZCA9IGZhY2V0c1tmaWVsZF07XG5cbiAgICBpZiAoIWZhY2V0c0ZvckZpZWxkKSByZXR1cm4gbnVsbDtcblxuICAgIC8vIEJ5IHVzaW5nIGBbMF1gLCB3ZSBhcmUgY3VycmVudGx5IGFzc3VtaW5nIG9ubHkgMSBmYWNldCBwZXIgZmllbGQuIFRoaXMgd2lsbCBsaWtlbHkgYmUgZW5mb3JjZWRcbiAgICAvLyBpbiBmdXR1cmUgdmVyc2lvbiwgc28gaW5zdGVhZCBvZiBhbiBhcnJheSwgdGhlcmUgd2lsbCBvbmx5IGJlIG9uZSBmYWNldCBhbGxvd2VkIHBlciBmaWVsZC5cbiAgICBjb25zdCBmYWNldCA9IGZhY2V0c0ZvckZpZWxkWzBdO1xuXG4gICAgbGV0IGZhY2V0VmFsdWVzID0gbWFya1NlbGVjdGVkRmFjZXRWYWx1ZXNGcm9tRmlsdGVycyhcbiAgICAgIGZhY2V0LFxuICAgICAgZmlsdGVycyxcbiAgICAgIGZpZWxkLFxuICAgICAgZmlsdGVyVHlwZVxuICAgICkuZGF0YTtcblxuICAgIGNvbnN0IHNlbGVjdGVkVmFsdWVzID0gZmFjZXRWYWx1ZXNcbiAgICAgIC5maWx0ZXIoZnYgPT4gZnYuc2VsZWN0ZWQpXG4gICAgICAubWFwKGZ2ID0+IGZ2LnZhbHVlKTtcblxuICAgIGlmICghZmFjZXRWYWx1ZXMubGVuZ3RoICYmICFzZWxlY3RlZFZhbHVlcy5sZW5ndGgpIHJldHVybiBudWxsO1xuXG4gICAgaWYgKHNlYXJjaFRlcm0udHJpbSgpKSB7XG4gICAgICBmYWNldFZhbHVlcyA9IGZhY2V0VmFsdWVzLmZpbHRlcihvcHRpb24gPT5cbiAgICAgICAgYWNjZW50Rm9sZChvcHRpb24udmFsdWUpXG4gICAgICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAuaW5jbHVkZXMoYWNjZW50Rm9sZChzZWFyY2hUZXJtKS50b0xvd2VyQ2FzZSgpKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCBWaWV3ID0gdmlldyB8fCBNdWx0aUNoZWNrYm94RmFjZXQ7XG5cbiAgICByZXR1cm4gVmlldyh7XG4gICAgICBjbGFzc05hbWUsXG4gICAgICBsYWJlbDogbGFiZWwsXG4gICAgICBvbk1vcmVDbGljazogdGhpcy5oYW5kbGVDbGlja01vcmUuYmluZCh0aGlzLCBmYWNldFZhbHVlcy5sZW5ndGgpLFxuICAgICAgb25SZW1vdmU6IHZhbHVlID0+IHtcbiAgICAgICAgcmVtb3ZlRmlsdGVyKGZpZWxkLCB2YWx1ZSwgZmlsdGVyVHlwZSk7XG4gICAgICB9LFxuICAgICAgb25DaGFuZ2U6IHZhbHVlID0+IHtcbiAgICAgICAgc2V0RmlsdGVyKGZpZWxkLCB2YWx1ZSwgZmlsdGVyVHlwZSk7XG4gICAgICB9LFxuICAgICAgb25TZWxlY3Q6IHZhbHVlID0+IHtcbiAgICAgICAgYWRkRmlsdGVyKGZpZWxkLCB2YWx1ZSwgZmlsdGVyVHlwZSk7XG4gICAgICB9LFxuICAgICAgb3B0aW9uczogZmFjZXRWYWx1ZXMuc2xpY2UoMCwgbW9yZSksXG4gICAgICBzaG93TW9yZTogZmFjZXRWYWx1ZXMubGVuZ3RoID4gbW9yZSxcbiAgICAgIHZhbHVlczogc2VsZWN0ZWRWYWx1ZXMsXG4gICAgICBzaG93U2VhcmNoOiBpc0ZpbHRlcmFibGUsXG4gICAgICBvblNlYXJjaDogdmFsdWUgPT4ge1xuICAgICAgICB0aGlzLmhhbmRsZUZhY2V0U2VhcmNoKHZhbHVlKTtcbiAgICAgIH0sXG4gICAgICBzZWFyY2hQbGFjZWhvbGRlcjogYEZpbHRlciAke2ZpZWxkfWAsXG4gICAgICAuLi5yZXN0XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgd2l0aFNlYXJjaChcbiAgKHsgZmlsdGVycywgZmFjZXRzLCBhZGRGaWx0ZXIsIHJlbW92ZUZpbHRlciwgc2V0RmlsdGVyLCBhMTF5Tm90aWZ5IH0pID0+ICh7XG4gICAgZmlsdGVycyxcbiAgICBmYWNldHMsXG4gICAgYWRkRmlsdGVyLFxuICAgIHJlbW92ZUZpbHRlcixcbiAgICBzZXRGaWx0ZXIsXG4gICAgYTExeU5vdGlmeVxuICB9KVxuKShGYWNldENvbnRhaW5lcik7XG4iXX0=