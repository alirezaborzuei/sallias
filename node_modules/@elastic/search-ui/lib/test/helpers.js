"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMockApiConnector = getMockApiConnector;
exports.setupDriver = setupDriver;
exports.doesStateHaveResponseData = doesStateHaveResponseData;
exports.getSearchCalls = getSearchCalls;
exports.getAutocompleteCalls = getAutocompleteCalls;
exports.getClickCalls = getClickCalls;
exports.getAutocompleteClickCalls = getAutocompleteClickCalls;
exports.waitATick = waitATick;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _SearchDriver = _interopRequireDefault(require("../SearchDriver"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var suggestions = {
  documents: [{
    suggestion: "carlsbad"
  }, {
    suggestion: "carlsbad caverns"
  }, {
    suggestion: "carolina"
  }]
};
var searchResponse = {
  totalResults: 1000,
  totalPages: 100,
  requestId: "12345",
  facets: {},
  results: [{}, {}]
};
var autocompleteSearchResponse = {
  requestId: "6789",
  results: [{}, {}]
};

function getMockApiConnector() {
  return {
    onAutocomplete: jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb({
          autocompletedResults: autocompleteSearchResponse.results,
          autocompletedResultsRequestId: autocompleteSearchResponse.requestId,
          autocompletedSuggestions: suggestions
        });
      }
    }),
    onSearch: jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb(searchResponse);
      }
    }),
    onResultClick: jest.fn().mockReturnValue({
      then: function then() {}
    }),
    onAutocompleteResultClick: jest.fn().mockReturnValue({
      then: function then() {}
    })
  };
}

function setupDriver() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      mockSearchResponse = _ref.mockSearchResponse,
      mockApiConnector = _ref.mockApiConnector,
      rest = (0, _objectWithoutProperties2.default)(_ref, ["mockSearchResponse", "mockApiConnector"]);

  mockApiConnector = mockApiConnector || getMockApiConnector();

  if (mockSearchResponse) {
    mockApiConnector.onSearch = jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb(mockSearchResponse);
      }
    });
  }

  var driver = new _SearchDriver.default(_objectSpread(_objectSpread({
    apiConnector: mockApiConnector
  }, rest), {}, {
    // We don't want to deal with async in our tests, so pass 0 so URL state
    // pushes happen synchronously
    urlPushDebounceLength: 0
  }));
  var updatedStateAfterAction = {};
  driver.subscribeToStateChanges(function (newState) {
    updatedStateAfterAction.state = newState;
  });
  jest.runAllTimers();
  return {
    stateAfterCreation: driver.getState(),
    driver: driver,
    updatedStateAfterAction: updatedStateAfterAction,
    mockApiConnector: mockApiConnector
  };
}

function doesStateHaveResponseData(response) {
  var requestId = response.requestId,
      results = response.results,
      totalPages = response.totalPages,
      totalResults = response.totalResults,
      wasSearched = response.wasSearched;
  return !!results && results.length && !!requestId && totalPages > 0 && totalResults > 0 && !!wasSearched;
}

function getSearchCalls(mockApiConnector) {
  return mockApiConnector.onSearch.mock.calls;
}

function getAutocompleteCalls(mockApiConnector) {
  return mockApiConnector.onAutocomplete.mock.calls;
}

function getClickCalls(mockApiConnector) {
  return mockApiConnector.onResultClick.mock.calls;
}

function getAutocompleteClickCalls(mockApiConnector) {
  return mockApiConnector.onAutocompleteResultClick.mock.calls;
}
/**
 * Returns a promise that resolves after the current event loop.
 *
 * Useful for writing `await waitATick()` to wait for a promise to resolve.
 */


function waitATick() {
  var promiseResolve;
  var promise = new Promise(function (resolve) {
    return promiseResolve = resolve;
  });
  setTimeout(function () {
    return promiseResolve();
  });
  jest.runAllTimers();
  return promise;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0L2hlbHBlcnMuanMiXSwibmFtZXMiOlsic3VnZ2VzdGlvbnMiLCJkb2N1bWVudHMiLCJzdWdnZXN0aW9uIiwic2VhcmNoUmVzcG9uc2UiLCJ0b3RhbFJlc3VsdHMiLCJ0b3RhbFBhZ2VzIiwicmVxdWVzdElkIiwiZmFjZXRzIiwicmVzdWx0cyIsImF1dG9jb21wbGV0ZVNlYXJjaFJlc3BvbnNlIiwiZ2V0TW9ja0FwaUNvbm5lY3RvciIsIm9uQXV0b2NvbXBsZXRlIiwiamVzdCIsImZuIiwibW9ja1JldHVyblZhbHVlIiwidGhlbiIsImNiIiwiYXV0b2NvbXBsZXRlZFJlc3VsdHMiLCJhdXRvY29tcGxldGVkUmVzdWx0c1JlcXVlc3RJZCIsImF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyIsIm9uU2VhcmNoIiwib25SZXN1bHRDbGljayIsIm9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2siLCJzZXR1cERyaXZlciIsIm1vY2tTZWFyY2hSZXNwb25zZSIsIm1vY2tBcGlDb25uZWN0b3IiLCJyZXN0IiwiZHJpdmVyIiwiU2VhcmNoRHJpdmVyIiwiYXBpQ29ubmVjdG9yIiwidXJsUHVzaERlYm91bmNlTGVuZ3RoIiwidXBkYXRlZFN0YXRlQWZ0ZXJBY3Rpb24iLCJzdWJzY3JpYmVUb1N0YXRlQ2hhbmdlcyIsIm5ld1N0YXRlIiwic3RhdGUiLCJydW5BbGxUaW1lcnMiLCJzdGF0ZUFmdGVyQ3JlYXRpb24iLCJnZXRTdGF0ZSIsImRvZXNTdGF0ZUhhdmVSZXNwb25zZURhdGEiLCJyZXNwb25zZSIsIndhc1NlYXJjaGVkIiwibGVuZ3RoIiwiZ2V0U2VhcmNoQ2FsbHMiLCJtb2NrIiwiY2FsbHMiLCJnZXRBdXRvY29tcGxldGVDYWxscyIsImdldENsaWNrQ2FsbHMiLCJnZXRBdXRvY29tcGxldGVDbGlja0NhbGxzIiwid2FpdEFUaWNrIiwicHJvbWlzZVJlc29sdmUiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Il0s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QixnQkFBbkMsRUFBcUQ7QUFDMUQsU0FBT0EsZ0JBQWdCLENBQUNILHlCQUFqQixDQUEyQ3FCLElBQTNDLENBQWdEQyxLQUF2RDtBQUNEO0FBRUQ7Ozs7Ozs7QUFLTyxTQUFTSSxTQUFULEdBQXFCO0FBQzFCLE1BQUlDLGNBQUo7QUFDQSxNQUFNQyxPQUFPLEdBQUcsSUFBSUMsT0FBSixDQUFZLFVBQUFDLE9BQU87QUFBQSxXQUFLSCxjQUFjLEdBQUdHLE9BQXRCO0FBQUEsR0FBbkIsQ0FBaEI7QUFDQUMsRUFBQUEsVUFBVSxDQUFDO0FBQUEsV0FBTUosY0FBYyxFQUFwQjtBQUFBLEdBQUQsQ0FBVjtBQUNBckMsRUFBQUEsSUFBSSxDQUFDdUIsWUFBTDtBQUNBLFNBQU9lLE9BQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTZWFyY2hEcml2ZXIgZnJvbSBcIi4uL1NlYXJjaERyaXZlclwiO1xuXG5jb25zdCBzdWdnZXN0aW9ucyA9IHtcbiAgZG9jdW1lbnRzOiBbXG4gICAge1xuICAgICAgc3VnZ2VzdGlvbjogXCJjYXJsc2JhZFwiXG4gICAgfSxcbiAgICB7XG4gICAgICBzdWdnZXN0aW9uOiBcImNhcmxzYmFkIGNhdmVybnNcIlxuICAgIH0sXG4gICAge1xuICAgICAgc3VnZ2VzdGlvbjogXCJjYXJvbGluYVwiXG4gICAgfVxuICBdXG59O1xuXG5jb25zdCBzZWFyY2hSZXNwb25zZSA9IHtcbiAgdG90YWxSZXN1bHRzOiAxMDAwLFxuICB0b3RhbFBhZ2VzOiAxMDAsXG4gIHJlcXVlc3RJZDogXCIxMjM0NVwiLFxuICBmYWNldHM6IHt9LFxuICByZXN1bHRzOiBbe30sIHt9XVxufTtcblxuY29uc3QgYXV0b2NvbXBsZXRlU2VhcmNoUmVzcG9uc2UgPSB7XG4gIHJlcXVlc3RJZDogXCI2Nzg5XCIsXG4gIHJlc3VsdHM6IFt7fSwge31dXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TW9ja0FwaUNvbm5lY3RvcigpIHtcbiAgcmV0dXJuIHtcbiAgICBvbkF1dG9jb21wbGV0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICB0aGVuOiBjYiA9PlxuICAgICAgICBjYih7XG4gICAgICAgICAgYXV0b2NvbXBsZXRlZFJlc3VsdHM6IGF1dG9jb21wbGV0ZVNlYXJjaFJlc3BvbnNlLnJlc3VsdHMsXG4gICAgICAgICAgYXV0b2NvbXBsZXRlZFJlc3VsdHNSZXF1ZXN0SWQ6IGF1dG9jb21wbGV0ZVNlYXJjaFJlc3BvbnNlLnJlcXVlc3RJZCxcbiAgICAgICAgICBhdXRvY29tcGxldGVkU3VnZ2VzdGlvbnM6IHN1Z2dlc3Rpb25zXG4gICAgICAgIH0pXG4gICAgfSksXG4gICAgb25TZWFyY2g6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB0aGVuOiBjYiA9PiBjYihzZWFyY2hSZXNwb25zZSkgfSksXG4gICAgb25SZXN1bHRDbGljazogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHRoZW46ICgpID0+IHt9IH0pLFxuICAgIG9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2s6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB0aGVuOiAoKSA9PiB7fSB9KVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0dXBEcml2ZXIoe1xuICBtb2NrU2VhcmNoUmVzcG9uc2UsXG4gIG1vY2tBcGlDb25uZWN0b3IsXG4gIC4uLnJlc3Rcbn0gPSB7fSkge1xuICBtb2NrQXBpQ29ubmVjdG9yID0gbW9ja0FwaUNvbm5lY3RvciB8fCBnZXRNb2NrQXBpQ29ubmVjdG9yKCk7XG5cbiAgaWYgKG1vY2tTZWFyY2hSZXNwb25zZSkge1xuICAgIG1vY2tBcGlDb25uZWN0b3Iub25TZWFyY2ggPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIHRoZW46IGNiID0+IGNiKG1vY2tTZWFyY2hSZXNwb25zZSlcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGRyaXZlciA9IG5ldyBTZWFyY2hEcml2ZXIoe1xuICAgIGFwaUNvbm5lY3RvcjogbW9ja0FwaUNvbm5lY3RvcixcbiAgICAvLyBQYXNzLCBlLmcuLCBpbml0aWFsU3RhdGUgYW5kIGFsbCBvdGhlciBjb25maWdzXG4gICAgLi4ucmVzdCxcbiAgICAvLyBXZSBkb24ndCB3YW50IHRvIGRlYWwgd2l0aCBhc3luYyBpbiBvdXIgdGVzdHMsIHNvIHBhc3MgMCBzbyBVUkwgc3RhdGVcbiAgICAvLyBwdXNoZXMgaGFwcGVuIHN5bmNocm9ub3VzbHlcbiAgICB1cmxQdXNoRGVib3VuY2VMZW5ndGg6IDBcbiAgfSk7XG5cbiAgY29uc3QgdXBkYXRlZFN0YXRlQWZ0ZXJBY3Rpb24gPSB7fTtcbiAgZHJpdmVyLnN1YnNjcmliZVRvU3RhdGVDaGFuZ2VzKG5ld1N0YXRlID0+IHtcbiAgICB1cGRhdGVkU3RhdGVBZnRlckFjdGlvbi5zdGF0ZSA9IG5ld1N0YXRlO1xuICB9KTtcblxuICBqZXN0LnJ1bkFsbFRpbWVycygpO1xuXG4gIHJldHVybiB7XG4gICAgc3RhdGVBZnRlckNyZWF0aW9uOiBkcml2ZXIuZ2V0U3RhdGUoKSxcbiAgICBkcml2ZXIsXG4gICAgdXBkYXRlZFN0YXRlQWZ0ZXJBY3Rpb24sXG4gICAgbW9ja0FwaUNvbm5lY3RvclxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZG9lc1N0YXRlSGF2ZVJlc3BvbnNlRGF0YShyZXNwb25zZSkge1xuICBjb25zdCB7XG4gICAgcmVxdWVzdElkLFxuICAgIHJlc3VsdHMsXG4gICAgdG90YWxQYWdlcyxcbiAgICB0b3RhbFJlc3VsdHMsXG4gICAgd2FzU2VhcmNoZWRcbiAgfSA9IHJlc3BvbnNlO1xuICByZXR1cm4gKFxuICAgICEhcmVzdWx0cyAmJlxuICAgIHJlc3VsdHMubGVuZ3RoICYmXG4gICAgISFyZXF1ZXN0SWQgJiZcbiAgICB0b3RhbFBhZ2VzID4gMCAmJlxuICAgIHRvdGFsUmVzdWx0cyA+IDAgJiZcbiAgICAhIXdhc1NlYXJjaGVkXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZWFyY2hDYWxscyhtb2NrQXBpQ29ubmVjdG9yKSB7XG4gIHJldHVybiBtb2NrQXBpQ29ubmVjdG9yLm9uU2VhcmNoLm1vY2suY2FsbHM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBdXRvY29tcGxldGVDYWxscyhtb2NrQXBpQ29ubmVjdG9yKSB7XG4gIHJldHVybiBtb2NrQXBpQ29ubmVjdG9yLm9uQXV0b2NvbXBsZXRlLm1vY2suY2FsbHM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDbGlja0NhbGxzKG1vY2tBcGlDb25uZWN0b3IpIHtcbiAgcmV0dXJuIG1vY2tBcGlDb25uZWN0b3Iub25SZXN1bHRDbGljay5tb2NrLmNhbGxzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXV0b2NvbXBsZXRlQ2xpY2tDYWxscyhtb2NrQXBpQ29ubmVjdG9yKSB7XG4gIHJldHVybiBtb2NrQXBpQ29ubmVjdG9yLm9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2subW9jay5jYWxscztcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIGFmdGVyIHRoZSBjdXJyZW50IGV2ZW50IGxvb3AuXG4gKlxuICogVXNlZnVsIGZvciB3cml0aW5nIGBhd2FpdCB3YWl0QVRpY2soKWAgdG8gd2FpdCBmb3IgYSBwcm9taXNlIHRvIHJlc29sdmUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3YWl0QVRpY2soKSB7XG4gIGxldCBwcm9taXNlUmVzb2x2ZTtcbiAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gKHByb21pc2VSZXNvbHZlID0gcmVzb2x2ZSkpO1xuICBzZXRUaW1lb3V0KCgpID0+IHByb21pc2VSZXNvbHZlKCkpO1xuICBqZXN0LnJ1bkFsbFRpbWVycygpO1xuICByZXR1cm4gcHJvbWlzZTtcbn1cbiJdfQ==